<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Owner Managerment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!--Include the Jquery-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <h1>My Orders</h1>

    <a href="/owner/new" class="btn btn-primary mb-3">Restaurant Menu</Menu></a>
    <h1>Order</h1>

    <table class="table">
        <thead>
            <tr>
                <th>Customer</th>
                <th>Customer phone</th>
                <th>Delivery_address</th>
                <th>Order_time</th>
                <th>Total_price</th>
                <th>Order_status</th>
                <th>Driver Name</th>
                <th>Driver License</th>
                <th>Delivery_Image</th>
            </tr>
        </thead>
        <tbody>
            <% if (orders && orders.length> 0) { %>
                <% orders.forEach(order=> { %>
                    <tr>
                        <td>
                            <%= order.customer.firstName %>
                                <%= order.customer.lastName %>
                        </td>
                        <td>
                            <%= order.customer.phone %>
                        </td>
                        <td>
                            <%= `${order.delivery_Address.street}, ${order.delivery_Address.city},
                                ${order.delivery_Address.state} ${order.delivery_Address.zipCode},
                                ${order.delivery_Address.country}` %>

                        </td>
                        <td>
                            <% const orderDate=new Date(order.orderDate); let finalFormattedDate; if
                                (isNaN(orderDate.getTime())) { // Handle invalid date finalFormattedDate="Invalid Date"
                                ; } else { const formattedTime=orderDate.toLocaleTimeString([], { hour: '2-digit' ,
                                minute: '2-digit' }); const formattedDate=orderDate.toLocaleDateString();
                                finalFormattedDate=`${formattedTime} ${formattedDate}`; } %>

                                <%= finalFormattedDate %> <!-- Output the formatted date -->
                        </td>

                        <td>
                            <%= order.totalPrice %>
                        </td>
                        <td>
                            <%= order.orderStatus %>
                        </td>
                        <td>
                            <%= order.driver?.firstName || 'null' %>
                        </td>
                        <td>
                            <%= order.driver?.license || 'null' %>
                        </td>

                        <td>
                            <%= order.delivered_image_url %>
                        </td>
                        <td>
                            <form action="/owner/orders/<%= order._id %>/view " method="get">
                                <button type="submit" class="btn btn-sm btn-danger">view</button>
                            </form>
                        </td>
                        <td>
                            <% if (order.orderStatus === 'New') { %>
                                <form action="/owner/orders/<%= order._id %>/edit" method="post">
                                    <button type="submit" class="btn btn-sm btn-primary">Ready</button>
                                </form>
                            <% } else { %>
                                <button type="button" class="btn btn-sm btn-secondary" disabled>Ready</button>
                            <% } %>
                        </td>
                    </tr>
                    <% }); %>
                        <% } else { %>
                            <tr>
                                <td colspan="5">No Menus found</td>
                            </tr>
                            <% } %>


        </tbody>

    </table>


</body>

</html>